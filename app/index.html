<!doctype html>
<html lang="en-US">
  <head>
    <script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Interactive: Coal & Gas Extraction Near WV Water Sources</title>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="152x152" href="https://ohiovalleyresource.org/wp-content/themes/wfpl-v2/res/img/apple-touch-icon-152-precomposed.png" />
    <link rel="icon" sizes="120x120" href="https://ohiovalleyresource.org/wp-content/themes/wfpl-v2/res/img/apple-touch-icon-120-precomposed.png" />
    <link rel="icon" sizes="76x76" href="https://ohiovalleyresource.org/wp-content/themes/wfpl-v2/res/img/apple-touch-icon-76-precomposed.png" />
    <!-- Safari, you're the worst -->
    <meta name='format-detection' content='telephone=no'>
    
    
    <!-- BEGIN TWITTER SUMMARY CARD -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Interactive: Coal & Gas Extraction Near WV Water Sources">
    <meta name="twitter:site" content="@OVReSRC">
    <meta name="twitter:url" content="https://local.wfpl.org/ovr/water-hazards/index.html">
    <meta name="twitter:image" content="https://local.wfpl.org/ovr/water-hazards/assets/ovr-water-hazards-cover.png">
    <meta name="twitter:description" content="EXPLORE: The Ohio Valley ReSource used data on protected water areas to build this tool showing some of the coal mines and gas wells within the watersheds providing West Virginians drinking water.">
    
    <!-- Social sharing meta -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Interactive: Coal & Gas Extraction Near WV Water Sources">
    <meta property="og:site_name" content="Ohio Valley ReSource">
    <meta property="og:url" content="https://local.wfpl.org/ovr/water-hazards/index.html">
    <meta property="og:image" content="https://local.wfpl.org/ovr/water-hazards/assets/ovr-water-hazards-cover.png">
    <meta property="og:description" content="EXPLORE: The Ohio Valley ReSource used data on protected water areas to build this tool showing some of the coal mines and gas wells within the watersheds providing West Virginians drinking water.">
    
    <!-- Google structured data -->
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "NewsArticle",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://local.wfpl.org/ovr/water-hazards/"
      },
      "headline": "Interactive: Coal & Gas Extraction Near WV Water Sources",
      "image": {
        "@type": "ImageObject",
        "url": "https://local.wfpl.org/ovr/water-hazards/assets/ovr-water-hazards-cover.png"
      },
      "author": {
        "@type": "Person",
        "name": "NPR Staff"
      },
      "publisher": {
        "@type": "Organization",
        "name": "NPR",
        "logo": {
          "@type": "ImageObject",
          "url": "https://local.wfpl.org/ovr/water-hazards/assets/logo.png",
          "width": 891,
          "height": 296
        }
      },
      "description": "EXPLORE: The Ohio Valley ReSource used data on protected water areas to build this tool showing some of the coal mines and gas wells within the watersheds providing West Virginians drinking water."
    }
    </script>
    <link rel="stylesheet" type="text/css" href="Skeleton-2.0.4/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="Skeleton-2.0.4/css/skeleton.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    
    <style> /* set the CSS */
      body { font: 12px Arial;}
      path { 
          stroke: steelblue;
          stroke-width: 2;
          fill: none;
      }
      .axis path,
      .axis line {
          fill: none;
          stroke: grey;
          stroke-width: 1;
          shape-rendering: crispEdges;
      }
    </style>
    
  </head>
  <body>
    <div id="container" class="container">
      <div id="container-top" class="row">
        <h1>Kentucky COVID-19 Case Tracker</h1>
        <div class="lead" id="intro">
          <p>BlargLorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi.</p>
        </div>
        
        <select id="county-select" class="row">
          <option>Select a county...</option>
        </select>
        
        <div id="state-stats" class="stat-row row">
          <table class="u-full-width">
            <thead>
              <tr>
                <th>State</th>
                <th>Total tests performed</th>
                <th>Total positive cases</th>
                <th>Total deaths</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Kentucky</td>
                <td>10,245</td>
                <td>1,398</td>
                <td>12</td>
              </tr>
            </tbody>
          </table>
        </div><!-- END STATE-STATS -->
        
        
      </div><!-- END CONTAINER-TOP -->
      
      <div id="stats" class="row">
        
        <div id="cnty-cases" class="stat-row row">
          <div id="cases-chart" class="chart one-half column">
            <!--<img src="assets/chart-example.png" alt="county covid-19 case count overtime" />-->
          </div>
          <div id="cases-text" class="text one-half column">
            <h5>Positive cases</strong></h5>
            <p>Epsum factorial non deposit quid pro quo hic escorol. Olypian quarrels et gorilla congolium sic ad nauseum. Souvlaki ignitus carborundum e pluribus unum. Defacto lingo est igpay atinlay. Marquee selectus non provisio incongruous feline nolo contendre. Gratuitous octopus niacin, sodium glutimate.</p>
          </div>
        </div>
        
        <div id="cnty-deaths" class="stat-row row">
          <div id="cases-chart" class="chart one-half column">
            <img src="assets/chart-example.png" alt="county covid-19 case count overtime" />
          </div>
          <div id="cases-text" class="text one-half column">
            <h5>Deaths</strong></h5>
            <p>Epsum factorial non deposit quid pro quo hic escorol. Olypian quarrels et gorilla congolium sic ad nauseum. Souvlaki ignitus carborundum e pluribus unum. Defacto lingo est igpay atinlay. Marquee selectus non provisio incongruous feline nolo contendre. Gratuitous octopus niacin, sodium glutimate.</p>
          </div>
        </div>
        <div id="cnty-demo" class="stat-row row">
          <div class="text">
            <h5>County vulnerable population information</strong></h5>
            <p><strong>Adair County, Kentucky</strong> has a population of <strong>19,241 people</strong>. <strong>21.9%</strong> of them are 62 years or older. They have a cardiovascular disease death rate of <strong>341.77 per 100,000</strong> people and a chronic respiratory disease death rate of <strong>65.02 per 100,000</strong> people. <strong>15.69%</strong> of the population 20 years and older have diabetes.</p>
            <p><em>*Cardiovascular disease, chronic respiratory disease and diabetes are all known complications to covid-19.</em></p>
          </div>
        </div>
        
      </div><!-- END STATS -->
      
      <div id="data-notes" class="row">
        <div id="data-sources">
          <p>Sources: xxxxxx; xxxxxx; xxxxxx</p>
        </div>
        <div id="data-disclaimers">
          <p>CB's Nuts Peanut Butter is produced in Washington State from peanuts grown in Texas. Aside from using the best peanuts in the world, our slow barrel roasting process is what sets us apart and gives our PB its rich roasted taste that's unlike any other brand on the market. Its also this roasting technique, along with our Creamunchy grind that limits annoying oil separation in the jar.</p>
        </div>
      </div><!-- END DATA-NOTES -->
    </div>
    
    <script>
      var data_file = 'assets/data/2020-03-22-California-export.csv';
      var state_fips = '21';
      var include_state_testing = false;
      
      //populate state stats
      
      
      
      //populate county select list
      d3.json("assets/data/cnty-fips.json", function(error, data) {
        if (error) {
          return console.warn(error);
        }
        var counties = Object.values(data[state_fips]).sort();
        var dropdown = d3.select('#county-select');
                          
        dropdown.selectAll('option')
            .data(counties)
          .enter().append('option')
            .attr('value', function(d) {
              return d;
              //console.log(d);
            })
            .text(function(d) {
                return d;
            });
      });
      
      // Set the dimensions of the canvas / graph
      var	margin = {top: 30, right: 20, bottom: 30, left: 50},
      	width = 600 - margin.left - margin.right,
      	height = 270 - margin.top - margin.bottom;
       
      // Parse the date / time
      var	parseDate = d3.time.format("%Y-%m-%d").parse;
       
      // Set the ranges
      var	x = d3.time.scale().range([0, width]);
      var	y = d3.scale.linear().range([height, 0]);
       
      // Define the axes
      var	xAxis = d3.svg.axis().scale(x)
      	.orient("bottom").ticks(5);
       
      var	yAxis = d3.svg.axis().scale(y)
      	.orient("left").ticks(5);
          
      // Adds the svg canvas
      var	svg = d3.select("#cases-chart")
      	.append("svg")
      		.attr("width", width + margin.left + margin.right)
      		.attr("height", height + margin.top + margin.bottom)
      	.append("g")
      		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
       
      // Get the data
      d3.csv(data_file, function(error, data) {
        //console.log(data);
      	data.forEach(function(d) {
      		d.date = parseDate(d.date);
      		d.POSITIVE = +d.POSITIVE;
      	});
      	
      	// Define the line
        var	valueline = d3.svg.line()
        	.x(function(d) { return x(d.date); })
        	.y(function(d) { return y(d.value); });
      	
      	//http://bl.ocks.org/phoebebright/raw/3176159/
      	var groupByDate = d3.nest()
          .key(function(d) { return d.date; })    // Groups on day
          .rollup(function(cases) { return d3.sum(cases, function(d) {return parseFloat(d.POSITIVE);}) })     // Counts how many records are in each date group
          .entries(data)   // Passes in the current tweet list for grouping and counting
             	
      	//http://learnjsdata.com/iterate_data.html
      	var dateLookup = groupByDate.reduce(function(lookup, date){ 
        	lookup[date.key] = date.values;
        	return lookup;
        }, {})
        
              	
      	var cumulativeByDate = function(){
          // Start the running count at zero.
          var runningCount = 0;
          // Loop through all the dates in the current filtered Tweet list
          return groupByDate.map(function(d){
            // Use the lookup and the date formatter to pull the count for each day.
            var dateCount = dateLookup[d.key] ? dateLookup[d.key] : 0;  // <-- If it isn't in the lookup, set it to zero.
            
            // Add each day's tally to the running count
            runningCount += dateCount;
            // Return a new datum for this date with the cumulative tally instead of that day's count.
            return {date: parseDate(d.key), value: runningCount};
          });
        }
        
        console.log(cumulativeByDate(dateLookup));
              
      	// Scale the range of the data
      	x.domain(d3.extent(data, function(d) { return d.date; }));
      	y.domain([0, d3.sum(data, function(d) {return parseFloat(d.POSITIVE);})]);
       
      	// Add the valueline path.
      	svg.append("path")	
      	  .datum(cumulativeByDate)
      		.attr("class", "line")
      		.attr("stroke-width", 5)
          .attr("stroke", "black")
      		.attr("d", valueline);
       
      	// Add the X Axis
      	svg.append("g")		
      		.attr("class", "x axis")
      		.attr("transform", "translate(0," + height + ")")
      		.call(xAxis);
       
      	// Add the Y Axis
      	svg.append("g")		
      		.attr("class", "y axis")
      		.call(yAxis);
      		
        
       
      });
      
    </script>
    <script>
    //  window.onload=function(){
    //    d3.json("assets/data/cnty-fips.json", function(error, data) {
    //      console.log(data);
    //      if (error) {
    //          return console.warn(error);
    //      }
    //      d3.select("select")
    //        .selectAll("option")
    //        .data(data)
    //        .enter()
    //        .append("option")
    //        .attr('value', function(d) {
    //          return d.values();
    //          //console.log(d);
    //        })
    //        .text(function(d) {
    //            return d.keys();
    //        });
    //    });
    //  }//]]>
        
        
        
        
        
      //  var stateSelect = d3.select("#state-select");
      //  
      //  var stateCounties = cnty_fips['06'];        
      //
      //  //we have select all options tags from inside select tag (which there are 0 atm)
      //  //and assigned data as to be the base of modelling that selection.
      //  var stateOptions = stateSelect.selectAll('option')
      //    .data(stateCounties);
      //    
      //  console.log(stateOptions);
      //
      //  //d3 sees we have less elements (0) than the data (2), so we are tasked to create
      //  //these missing inside the `options.enter` pseudo selection.
      //  //if we had some elements from before, they would be reused, and we could access their
      //  //selection with just `options`
      //  stateOptions.enter()
      //    .append('option')
      //    .attr('value', function(d) {
      //      return d.values();
      //      //console.log(d);
      //    })
      //    .text(function(d) {
      //      return d.values();
      //      //console.log(d);
      //    });
      //  });
      //
      //d3.select("#state-select")
      //  .append("select")
      //  .append("option")
      //  .attr("value", "---")
      //  .text("---");
      
      
      
      //const pymChild = new pym.Child({ polling: 100 });
      //  
      ////////////// THIS IS ALL AUTO GEOLOCATOR CODE. WE CAN'T USE IT UNTIL WE UPGRADE SERVER TO HTTPS
      //function getLocation() {
      //    if (navigator.geolocation) {
      //        navigator.geolocation.getCurrentPosition(autoGeo);
      //    } else {
      //        console.log("Geolocation is not supported by this browser.");
      //    }
      //}
      //
      //function autoGeo(position){
      //  var foundLat = position.coords.latitude;
      //  var foundLng = position.coords.longitude;
      //  var point = [foundLat, foundLng];
      //  var inKY = findState(point);
      //  
      //  if(inKY == 1){
      //    if(marker){
      //      map.removeLayer(marker); 
      //    }
      //    marker = L.marker([foundLat, foundLng]).addTo(map);
      //    map.flyTo(new L.LatLng(foundLat, foundLng), 11);
      //    findDistrict(foundLat,foundLng)
      //  }else{
      //    houseDIV.innerHTML = "<p><em>Looks like you're not in Kentucky</em></p>";
      //    metroDIV.innerHTML = "<p><em>Looks like you're not in Jefferson County</em></p>";
      //    houseContestDIV.innerHTML = '';
      //    metroContestDIV.innerHTML = '';
      //  }
      //}
      //  
      //function findState(point){
      //  const addURL = 'http://dev.virtualearth.net/REST/v1/Locations/' + point + '?o=json&key=' + BING_KEY;
      //  
      //  $.ajax({
      //    url: addURL,
      //    type: 'GET',
      //    success: function(result){
      //      var state = result['resourceSets'][0]['resources'][0]['address']['adminDistrict'];
      //      
      //      geoResultsDIV.innerHTML = 'Showing results for ' + result['resourceSets'][0]['resources'][0]['address']['formattedAddress'];
      //      
      //      if(state != 'KY'){
      //        return 0;
      //      }else{
      //        return 1;
      //      }            
      //    },
      //    error: function(error){
      //      console.log(`Error ${error}`)
      //    }
      //  })
      //}
        ////////////// END AUTO GEOLOCATON
    </script>
    
    <script src="app.js" async></script>
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
    //If we're embedding, we don't want to make this a new session so keep this commented out
    //ga('create', 'UA-5828686-4', 'auto');
    //
    ga('send', 'pageview');
    </script>
    <!-- End Google Analytics -->
  </body>
</html>
